<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="description" content="BSides Presentation - November 2016">
		<meta name="author" content="Ari Neto">
		<meta name="author" content="Joelson Soares">
		<title>from hell to heaven to hell</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<!-- <body> -->
	<body style="transition: -webkit-transform 0.8s ease;">
		<!-- <div class="reveal"> -->
		<div class="reveal convex center" role="application" data-transition-speed="default" data-background-transition="fade">
			<div class="slides">
				<section>
					<h1>From hell to Heaven to hell</h1>
					<h3>BSides 2016</h3>
					<p>
						Joelson Soares - <a href="https://www.linkedin.com/in/joelson">https://www.linkedin.com/in/joelson</a> / <a href="mailto:joelson_soares@trendmicro.com">joelson_soares@trendmicro.com</a> / <a href="http://malwar.org/">malwar.org</a>
					</p>
					<p>
						Ari Neto - <a href="https://br.linkedin.com/in/arineto">https://br.linkedin.com/in/arineto</a> / <a href="mailto:ari_neto@trendmicro.com">ari_neto@trendmicro.com</a>
					</p>
					<p>
						<small>Using reveal.js - Created by <a href="http://hakim.se">Hakim El Hattab</a> / <a href="http://twitter.com/hakimel">@hakimel</a></small>
					</p>
					<aside class="notes">
                  <p>- Abertura</p>
                  <p>- Joelson</p>
                  <p>- Ari</p>
               </aside>
				</section>
				<section>
					<h2>Quem somos nós?</h2>
					<!-- <p>
						<img src="img/joelson.jpg" alt="Joelson" style="float:left">
						Joelson Soares - Com experiência em tecnologias de infraestrutura, redes, serviços, gerenciamento e segurança.
					</p>
					<p>
						<img src="img/ari.jpg" alt="Joelson" style="float:left">
						Ari Neto - Com experiência em infraestrutura, virtualização, redes, armazenamento, nuvem, automação.
					</p> -->
				</section>
				<section data-background="img/in_the_beginning.jpg" data-background-transition="zoom">
					<h1><font color="orange">No começo...</font></h1>
				</section>
				<section data-background="img/datacenter.jpg" data-background-transition="fade" id="fragments">
					<h2>Infraestrutura:</h2>
					<ul>
						<li>Muitas coisas para olhar:</li>
						<ul>
							<li class="fragment fade-up">Compute (CPU/Memory/NET_IO/Disk_IO)</li>
							<li class="fragment fade-up">Network (Switches, Routers, Load Balancers)</li>
							<li class="fragment fade-up">Network Security (Firewalls, IPS, IDS, Proxies, VPN Concentrators)</li>
							<li class="fragment fade-up">Storage (Disk, Block, Tape)</li>
							<li class="fragment fade-up">Racks, Cabling, HVAC - Heating, ventilation and air conditioning</li>
							<!-- <p>Highlight <span class="fragment highlight-red">red</span> <span class="fragment highlight-blue">blue</span> <span class="fragment highlight-green">green</span></p> -->
						</ul>
					</ul>
					<p class="fragment current-visible">...distanciando das necessidades da área de negócio...</p>
				</section>
				<section <section data-background="img/perimeter.jpg" data-background="zoom" data-background-size="cover">
					<h3>Meu Perímetro...</h3>
					<!-- <img src="img/perimeter.jpg" alt="Perimeter" style="float:right;width:200px;height:200px;"> -->
					<p>
						<ul>
							<li>Firewall FrontEnd/BackEnd</li>
							<li>IPS de Rede</li>
							<li>Detecção de APT</li>
							<li>Antispam / Controle de Navegação</li>
							<li>Antimalware</li>
							<li>Concentrador de VPN / Acesso Remoto</li>
							<li>Load Balance/App Firewall</li>
							<li>VLANs: Web / App / Data</li>
							<li>IPS de Host</li>
							<li>Mobile/BYOD</li>
							<li>Hardening de SO/APP</li>
							<li>Controle software, Gestão de patches (endpoints/servidores)</li>
					</p>
				</section>
				<section data-background="img/solar-system.jpg" data-background="zoom" data-background-size="cover">
					<h3>Cada empresa tem o seu próprio ciclo:</h3>
					<ul>
						<li>Lifecycle: Refresh Software/Hardware</li>
						<li>Como manter o sofware e hardware atualizados</li>
						<li>Como usar novas tecnologias</li>
						<li>Decidir o que vc vai gerenciar e o que vc vai ser terceirizado...</li>
					</ul>
					<p class="fragment current-visible">...ciclos longos geralmente...</p>
					<br><br>
					<img src="img/ouroboros.png" alt="ouroboros" style="float:center;width:300px;height:200px;border:0">
				</section>
				<section data-background="img/it_management.png" data-background="zoom" data-background-size="cover">
					<h3>Demora, muitos detalhes técnicos... Muito complicado para comunicar para as áreas usuárias:</h3>
					<ul>
						<li class="fragment fade-up">Planejamento: Definindo a arquitetura</li>
						<li class="fragment fade-up">Planejamento: Transformando os requerimentos de arquitetura em tecnologia e serviços</li>
						<li class="fragment fade-up">Compras: Hardware, Software e Serviços</li>
						<p class="fragment current-visible">...Ufa!!! Mas falta o deploy...</p>
				</section>
				<section data-background="img/it_management.png" data-background="zoom">
					<h3>Implantação:</h3>
						<ul class="fragment fade-up">
								<li><strong>Datacenter:</strong> Espaço físico, Cabling, HVAC</li>
								<li><strong>Setup:</strong> SO, patches, managament/monitoring/antimalware</li>
								<li><strong>Gerenciamento:</strong> hostname/ip, firewall rules, managament/monitoring/antimalware</li>
								<li><strong>Segurança:</strong> security baseline, vulnerability assessment, event forwarding</li>
								<li><strong>Backup:</strong> backup survey and deployment</li>
								<li><strong>Aplicação:</strong> application deployment, dev/qa/prod environments, monitoring, batch scheduling</li>
								<li><strong>Transição para produção:</strong> RFCs/GMUDs, CMDB, management spreadsheets...</li>
								<li><strong>Go live!!!</strong></li>
						</ul>
						<!-- <p class="fragment current-visible">...Ufa!!!...</p> -->
				</section>
				<section>
					<h3>My Precious Infrastructure</h3>
					<p>
						<img src="img/my_precious_infrastructure.jpg" alt="My Precious Infrastructure" style="width:800px;height:500px;">
					</p>
				</section>
				<section data-background="img/i-am-waiting.jpg" data-background="zoom" data-background-size="cover">
					<h3>Ponto de vista dos nossos clientes:</h3>
					<ul>
						<li class="fragment fade-up">Dificuldade de entender a linguagem de TI</li>
						<li class="fragment fade-up">Muitos processos para seguir</li>
						<li class="fragment fade-up">Muitas razões para "não fazer" doque "como podemos fazer isso funcionar"</li>
						<li class="fragment fade-up">Difícil de ver TI como um parceiro ou um provedor de serviços</li>
						<li class="fragment fade-up">TI esta muito preocupada com sua visão de tecnologia e indicadores do que entregar tecnologia para novas oportunidades de negócio</li>
					</ul>
						<p class="fragment current-visible">...muito devagar...</p>
				</section>
				<section data-background="img/casa-velha.jpg" data-background-transition="fade" data-background-size="contain">
					<h2>Leaving Hell</h2>
					<p>
						É muito difícil manter a infraestrutura.
						<ul>
							<li>Manter segurança no perímetro</li>
							<li>Manter ambiente atualizado</li>
							<li>Replicar configurações</li>
							<li>Gestão de capacidade</li>
							<li>Auditar alterações</li>
							<li>Controle de acesso</li>
							<li>Manter ambiente documentado</li>
							<li>Deployment e reconfigurações de padrões</li>
					</p>
				</section>
				<section>
					<h2>Medo de reboot</h2>
					<p>
						<img src="img/fear_of_rebooting.png" alt="Medo de Reboot" style="float:center;width:700px;height:500px;">
						<a href="http://everythingsysadmin.com/2012/03/fear-of-rebooting.html"><small>http://everythingsysadmin.com/2012/03/fear-of-rebooting.html</small></a>
					</p>
				</section>
				<section>
					<h2>Se tivesse todos os patches aplicados não teria sido infectado</h2>
					<p>
						<img src="img/que_puxa.jpg" alt="Que Puxa" style="float:center;width:600px;height:400px;">
					</p>
				</section>
				<section>
					<h2>Solução... ir para a nuvem? Que nuvem?</h2>
					<p>
						<img src="img/que-nuvem.jpg" alt="Minha Nuvem" style="width:500px;height:500px;">
					</p>
				</section>
				<section data-background="img/chaves_zas.jpg" data-background-transition="zoom" data-background-size="contain">
					<h3 class="fragment fade-up">Minha Nuvem?</h3>
					<p class="fragment fade-up">
						Tecnologias:
						<ul class="fragment fade-up">
							<li>IaaS: Openstack, CloudStack</li>
							<li>Hypervisor: KVM, XenServer, ESXi, HyperV</li>
							<li>Network: SDN, NFV...</li>
							<li>Storage: SDS, Object, File, Block</li>
							<li>E muito mais...</li>
						</ul>
					</p>
				</section>
				<section>
					<h2>Going to heaven</h2>
					<p>
						É simples ir para nuvem? É só subir?
					</p>
				</section>
				<section>
					<h3>Pets vs Cattle...</h3>
					<img src="img/servers_pets_or_cattle.jpg" alt="Pets_Cattle" style="width:800px;height:500px;">
					<p>
						<small>
							Imagem: <a href:"http://www.theregister.co.uk/2013/03/18/servers_pets_or_cattle_cern/"> The Register - Are your servers PETS or CATTLE?</a>
						</small>
					</p>
				</section>
				<section>
					<h3>Então...</h3>
					<!-- <img src="img/hotel.png" alt="Perimeter" style="float:right;width:230px;height:150px;"> -->
					<p>
						<ul>
							<li>Shared Responsibility:</li>
								<ul>
									<small>
										<li>Controles Diferentes no Perímetro</li>
										<li>Desapego: Tchau equipamentos Físicos!</li>
										<li>VLANs? Tchau VLANs!!</li>
								</small>
							</ul><br>
							<li>Pensar Distribuído:</li>
								<ul>
									<small>
										<li>Infraestrutura como um <b><i><font color="orange">Pool de Recursos</font></i></b></li>
										<li>Alocação oportunística (<b><i><font color="orange">on demand</font></i></b>) de Recursos Computacionais</li>
										<li>Serviços Disponíveis pela <b><i><font color="orange">rede em alta velocidade</font></i></b></li>
									</small>
								</ul><br>
							<li>Pegue do <b><i><font color="orange">catálogo de serviços</font></i></b>:</li>
								<ul>
									<small>
										<li>Concentrador de VPN</li>
										<li>Load Balance</li>
										<li>Imagem de SO</li>
									</small>
								</ul>
					</p>
				</section>
				<section>
					<h3>Security Concerns - 2016</h3>
					<ul>
						<li>CSA - Cloud Securtiy Alliance</li>
						<ol type="1">
								<li>Application Flaw</li>
								<ul>
									<small>
										<li>Data Breaches</li>
										<li>Weak Identity, Credential and Access Management</li>
										<li>Insecure APIs</li>
										<li>System and Application Vulnerabilities</li>
										<li>Account Hijacking</li>
									</small>
								</ul>

								<li>Human Flaw</li>
								<ul>
									<small>
										<li>Malicious Insiders</li>
										<li>Advanced Persistent Threats (APTs)</li>
										<li>Data Loss</li>
									</small>
								</ul>
								<p>...o paraíso é real, ou uma versão do inferno?</p>
								<!-- <li>Insufficient Due Diligence</li>
								<li>Abuse and Nefarious Use of Cloud Services</li>
								<li>Denial of Service</li>
								<li>Shared Technology Issues</li> -->
						</ol>
						<br>
						<small>
							Source: <a href="https://cloudsecurityalliance.org/download/the-treacherous-twelve-cloud-computing-top-threats-in-2016/">https://cloudsecurityalliance.org/download/the-treacherous-twelve-cloud-computing-top-threats-in-2016/</a>
						</small>
					</ul>
				</section>
				<section data-background="img/hotel.png" data-background-transition="zoom" data-background-size="cover">
						<h1><font color="orange">Pague pelo Uso!</font></h3>
						<h2 class="fragment fade-up">Como um Hotel?</h2>
						<h2 class="fragment fade-up">SIM!!!</h2>
							<ul class="fragment fade-up">
									<li class="fragment fade-up">por hora/min</li>
									<li class="fragment fade-up">Pay as you go</li>
									<li class="fragment fade-up">Reservas</li>
									<li class="fragment fade-up">Leilão</li>
							</ul>
					</p>
				</section>
				<section>
					<h3>Respondendo à demanda...</h3>
					<p>
						<ul>
							<li>Autoscaling - Metric Load Alarms:
								<ul>
									<li>CPU</li>
									<li>Network</li>
									<li>IO</li>
									<li>Queue</li>
									<li>Custom metric</li>
								</ul>
				</section>
				<section data-background="img/resiliency.jpg" data-background-transition="zoom">
				</section>
				<section >
					<h3>Selfhealing - Detectando falhas e corrigindo</h3>
					<ul>
						<li>Service Port</li>
						<li>Health Status URL</li>
						<li>Application Cache Layers</li>
						<li>Persisting data</li>
							<ul>
								<li>Snapshot</li>
								<li>Object Storage</li>
							</ul>
					</ul>
				</section>
				<section data-background="img/gate_control.jpg" data-background-transition="zoom" data-backgorund-size="contain">
					<h2>Inviabilidade de Concentrar o Tráfego em um Portão</h2>
					<p>
						<a href:"http://www.dailymail.co.uk/news/article-3442101/Mesmerising-drone-footage-shows-hundreds-sheep-moving-like-starlings-herded-fields.html">Mail OnLine</a>
					</p>
				</section>
				<section data-background="img/airport_gates.jpg" data-background-transition="zoom" data-backgorund-size="contain">
					<h1>Múltiplos Portões</h1>
				</section>
				<section>
					<h3>Se o ambiente escala sozinho, como eu sei que esta consistente?</h3>
					<img src="img/smith_matrix.jpg" alt="Smith Matrix" style="width:800px;height:500px;">
				</section>
				<section>
					<h3>O Arquiteto ajuda?</h3>
					<img src="img/architect_matrix.jpg" alt="Architect Matrix" style="width:800px;height:500px;">
				</section>
				<section data-background="img/chef-puppet-ansible-blog-image.png" data-background-transition="fade" data-backgorund-size="contain">
					<h1>Configuration Managers</h1>
					<!-- <img src="img/chef-puppet-ansible-blog-image.png" alt="Coniguration Managers" style="width:800px;height:500px;"> -->
					<p>
						<small>
							Imagem: <a href:"https://blog.logentries.com/2014/09/log-analysis-takes-automated-orchestration-further/">Log Analysis Takes Automated Orchestration Further</a>
						</small>
					</p>
				</section>
				<section>
					<h3>Configuration Managers</h3>
					<p>
						Eles ajudam com várias coisas:
						<ul>
							<li>Definem a configuração em arquivo (que pode ser versionado)</li>
							<li>Garantem que o ambiente sempre estará em um estado pré-definido (idempotência)</li>
								<ul>
									<small>
										<li>Versão de Softawre</li>
										<li>Tunnings de SO: sysctl, ulimit, selinux, permissões..</li>
									</small>
								</ul>
							<li>Garantem a consistência de configuração em um ambiente distribuído</li>
							<li>Criam abstrações para acionamento do IaaS e do SO</li>
							<li>Dependendo de como você usar, adeus SSH!!</li>
							<li>Evite automatizar problemas!!!</li>
					</p>
				</section>
				<section data-background="img/get-over-here.jpg" data-background-transition="fade" data-backgorund-size="contain">
						<h3 class="fragment fade-up">Trazendo para o estado desejado</h3>
							<p>
								<ul class="fragment fade-up">
									<li><b><font color="orange">Puppet:</font></b><i> "If it finds any resources that are not in their <strong><font color="darkgreen">desired state</font></strong>, it makes any changes necessary to correct them."</i> <a href="https://docs.puppet.com/puppet/latest/reference/architecture.html"><br><small>https://docs.puppet.com/puppet/latest/reference/architecture.html</small></a></li>
									<li><b><font color="orange">Ansible:</font></b><i> "Ansible features an state-driven resource model that describes the <strong><font color="darkgreen">desired state</font></strong> of computer systems and services, not the paths to get them to this state."</i><br><small><a href="https://www.ansible.com/configuration-management">https://www.ansible.com/configuration-management</small></a></li>
									<li><b><font color="orange">Chef:</font></b><i> "...uses a “convergent” model of configuration. As changes propagate through the nodes, the network as a whole converges to the <strong><font color="darkgreen">desired configuration state</font></strong>."</i><br><small><a href="https://www.chef.io/solutions/infrastructure-automation/">https://www.chef.io/solutions/infrastructure-automation/</small></a></li>
								</ul>
							</p>
				</section>
				<section>
					<h3>Infrastructure as Code</h3>
					<pre><code data-trim data-noescape>
{
  "AWSTemplateFormatVersion" : "2010-09-09",

  "Description" : "AWS CloudFormation EC2InstanceWithSecurity: Create an Amazon EC2 instance running the Amazon Linux AMI.",

  "Parameters" : {
    "KeyName": {
      "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instance",
      "Type": "AWS::EC2::KeyPair::KeyName",
      "Default" : "secdash",
      "ConstraintDescription" : "must be the name of an existing EC2 KeyPair."
    },

    "InstanceType" : {
      "Description" : "WebServer EC2 instance type",
      "Type" : "String",
      "Default" : "t2.nano",
      "AllowedValues" : [ "t1.micro", "t2.nano", "t2.micro", "t2.small"]
,
      "ConstraintDescription" : "must be a valid EC2 instance type."
    },

    "VPC": {
        "Description" : "Id of my VPC",
        "Type"        : "String"
    },

    "Subnet": {
        "Description" : "VPC Public Subnet",
        "Type": "String"
    },

    "SSHLocation" : {
      "Description" : "The IP address range that can be used to SSH to the EC2 instances",
      "Type": "String",
      "MinLength": "9",
      "MaxLength": "18",
      "Default": "0.0.0.0/0",
      "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
      "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."
   },

    "DockerUser" : {
      "NoEcho": "true",
      "Description" : "The Docker Cloud Registry account username",
      "Type": "String",
      "MinLength": "1",
      "MaxLength": "16"
  },

    "DockerPassword" : {
      "NoEcho": "true",
      "Description" : "The Docker Cloud Registry account password",
      "Type": "String",
      "MinLength": "1",
      "MaxLength": "20"
  },

    "DockerEmail" : {
      "NoEcho": "true",
      "Description" : "The Docker Cloud Registry account email",
      "Type": "String",
      "MinLength": "1",
      "MaxLength": "30"
    }
  },

  "Mappings" : {
    "AWSInstanceType2Arch" : {
      "t2.nano"     : { "Arch" : "HVM64"  },
      "t2.micro"    : { "Arch" : "HVM64"  },
      "t2.small"    : { "Arch" : "HVM64"  }
    },

    "AWSRegionArch2AMI" : {
      "us-east-1"        : {"PV64" : "ami-2a69aa47", "HVM64" : "ami-8fcee4e5", "HVMG2" : "ami-2e5e9c43"}
    }

  },

  "Resources" : {
    "EC2Instance" : {
      "Type" : "AWS::EC2::Instance",
      "Properties" : {
        "InstanceType" : { "Ref" : "InstanceType" },
        "SecurityGroupIds" : [ { "Ref" : "InstanceSecurityGroup" } ],
        "KeyName" : { "Ref" : "KeyName" },
        "SubnetId": { "Ref": "Subnet" },
        "ImageId" : { "Fn::FindInMap" : [ "AWSRegionArch2AMI", { "Ref" : "AWS::Region" },
                          { "Fn::FindInMap" : [ "AWSInstanceType2Arch", { "Ref" : "InstanceType" }, "Arch" ] } ] },
        "UserData" : { "Fn::Base64" : { "Fn::Join" : ["", [
               "#!/bin/bash -xe\n",
               "yum install docker -y\n",
               "chkconfig docker on\n",
               "service docker start\n",
               "docker login",
               " -e ", { "Ref" : "DockerEmail" },
               " -u ", { "Ref" : "DockerUser" },
               " -p ", { "Ref" : "DockerPassword" }, "\n",
               "docker run --name=dois -h dois -p 80:8000 -d arineto/dois\n"
               ]]}}
      }
    },

    "InstanceSecurityGroup" : {
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
        "VpcId" : { "Ref" : "VPC" },
        "GroupDescription" : "DOIS - Enable SSH and HTTP",
        "SecurityGroupIngress" : [ {
          "IpProtocol" : "tcp",
          "FromPort" : "22",
          "ToPort" : "22",
          "CidrIp" : { "Ref" : "SSHLocation"}
        },
        {
          "IpProtocol" : "tcp",
          "FromPort" : "80",
          "ToPort" : "80",
          "CidrIp" : { "Ref" : "SSHLocation"}
        } ]
      }
    }
  },

  "Outputs" : {
    "InstanceId" : {
      "Description" : "InstanceId of the newly created EC2 instance",
      "Value" : { "Ref" : "EC2Instance" }
    },
    "AZ" : {
      "Description" : "Availability Zone of the newly created EC2 instance",
      "Value" : { "Fn::GetAtt" : [ "EC2Instance", "AvailabilityZone" ] }
    },
    "PublicDNS" : {
      "Description" : "Public DNSName of the newly created EC2 instance",
      "Value" : { "Fn::GetAtt" : [ "EC2Instance", "PublicDnsName" ] }
    },
    "PublicIP" : {
      "Description" : "Public IP address of the newly created EC2 instance",
      "Value" : { "Fn::GetAtt" : [ "EC2Instance", "PublicIp" ] }
    }
  }
}

					</code></pre>

					<!-- <p>
						<img src="img/infra_as_code.png" alt="Infrastructure as Code" style="float:center;width:700px;height:550px;">
					</p> -->
				</section>
				<section>
					<h3>Infrastructure as Code - CI/CD</h3>
					<small>Continous Integration / Continous Deployment
					<pre><code data-trim data-noescape>
machine:
  services:
    - docker
  environment:
    AWS_DEFAULT_REGION: us-east-1
  pre:
    - sudo pip install setuptools
    - sudo pip install ansible==2.1.1.0 boto==2.42.0 awscli==1.10.22
    - ansible --version
    - pip freeze

dependencies:
  override:
    - docker info
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - docker build -t $CIRCLE_PROJECT_REPONAME .

test:
  override:
    - docker run -d -p 80:8000 $CIRCLE_PROJECT_USERNAME; sleep 10
    - curl --retry 10 --retry-delay 5 -v http://localhost

deployment:
  production:
    branch: master
    commands:
      - docker tag dois $CIRCLE_PROJECT_USERNAME/tmbsides
      - docker push $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME:$CIRCLE_TAG
      - docker push $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
			- export ENV=prd ; cd ~/$CIRCLE_PROJECT_REPONAME/ansible/app-env ; ansible-playbook playbook.yml -vvvv
  staging:
    branch: staging
    commands:
      - docker tag dois $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME:$CIRCLE_BRANCH
      - docker push $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME:$CIRCLE_BRANCH
  feature:
    branch: /feature-.*/
    commands:
      - echo $CIRCLE_BRANCH
      - docker tag dois $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME:$CIRCLE_BRANCH
      - docker push $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME:$CIRCLE_BRANCH
      - export ENV=prd ; cd ~/$CIRCLE_PROJECT_REPONAME/ansible/app-env ; ansible-playbook playbook.yml -vvvv
					</pre></code>
				</section>
				<section>
					<h3>Blz... Mas se as instâncias nascem e morrem, o que significa gerenciar a configuração?</h3>
				</section>
				<section data-background="img/ugly-baby.jpg" data-background-transition="zoom" data-background-size="cover">
						<br><br><h2 class="fragment fade-up">A que nasceu:</h2>
							<ul class="fragment fade-up">
									<li>A instância entrou no gerenciamento/CMDB?</li>
									<li>Esta com todos os patches instalados?</li>
									<li>A aplicação esta rodando corretamente?</li>
									<li>Ela entrou na monitoração?</li>
									<li>Putz... Cadastraram na Planilha? huehuehue</li>
							</ul>
				</section>
				<section data-background="img/pica-pau-velho.jpg" data-background-transition="zoom" data-background-size="cover">
					<h3>A que morreu:</h3>
						<ul>
								<li>E os eventos de segurança?</li>
								<li>E a análise forense?</li>
								<li>E os eventos da aplicação?</li>
								<li>E a persistência dos dados em caso de um ataque?</li>
								<li>Xii, tá gerando um monte de eventos na monitoração...</li>
								<li>Tira da planilha!!!!!!</li>
								huehuehuehuehuehuehuehuehue
						</ul>
				</section>
				<section>
					<h3>Pensei que era mais fácil...</h3>
					<img src="img/concerns.jpg" alt="Concerns Cloud" style="width:800px;height:500px;">
					<p>
						<small>
							Imagem: <a href:"https://www.universalclass.com/articles/computers/reducing-your-vulnerability-to-computer-virus-attacks.htm">Reducing Your Vulnerability to Computer Virus Attacks</a>
						</small>
					</p>
				</section>
				<section data-background="img/big-data.png" data-transition="zoom" data-background-size="cover">
					<h3>Se tudo é dinâmico e distribuído... é importante</h3>
					<ul>
						<li>Gerar e persistir eventos</li>
						<li>Maneiras de apresentar esta informação para:</li>
							<ul>
								<li>Identificar origem: IaaS, Infraestrutura, Aplicação, Segurança?</li>
								<li>Gerar indicadores</li>
							</ul>
					</ul>
					<!-- <img src="img/elk.png" alt="ELK" style="width:400px;height:150px;">
					<img src="img/graylog.jpg" alt="Graylog" style="width:400px;height:150px;"> -->
				</section>
				<section data-background="img/dashboard.png" data-transition="zoom" data-background-size="contain">
				</section>
				<section data-background="img/a-vlan.jpg" data-transition="zoom" data-background-size="cover">
					<h1>Segmentação from hell</h1>
				</section>
				<section>
					<h3>Isso era difícil de fazer e agora é bem mais fácil...</h3>
					<img src="img/it_is_possible.jpg" alt="Concerns Cloud" style="width:800px;height:500px;">
				</section>

				<!-- <section>
					<h3>Segmentação...</h3>
					<p>
						É possível fazer leverage de várias funcionalidades de segmentação:
						<ul>
							<li>Policies, Roles</li>
							<li>Filtragem de Tráfego entre Subnets</li>
							<li>Controle granular do esquema de roteamento</li>
							<li>Security Groups</li>
							<ul>
								<small>
									<li>SG_A de serviço: permite porta 443/TCP para 0.0.0.0/0</li>
									<li>SG_B Web Tier: permite acesso na porta 80/TCP somente do SG_A</li>
									<li>SB_C App Tier: permite acesso na porta 8080/TCP somente do SG_B</li>
									<li>SB_D DB  Tier: permite acesso na porta 3306/TCP somente do SG_C</li>
								</small>
							</ul>
							<p>
								E também você sempre esta a um passo de publicar algo interno para o mundo... Atenção!
							</p>
						</p>
				</section> -->
				<section data-background="img/sg_segmentation.png" data-background-size="cover">
				</section>
				<section data-background="img/sg_segmentation-dark.png" data-background-size="cover">
					<h1 class="fragment fade-up"><font color="white">Segmentação from heaven</font></h1>
				</section>
				<section>
					<h1>E a segurança?</h1>
				</section>
				<section>
					<h3>Pense antes e integre no ciclo de provisionamento</h3>
					<ul>
						<li>Audite suas receitas de provisionamento</li>
						<li>Controle a origem do software</li>
						<li>Defina e aplique segurança como parte da infraestrutura</li>
						<li>Controle suas credenciais de provisionamento e credenciais de acesso às instâncias</li>
						<li>Restringir o acesso usando Security Groups, evite usar SGs genéricos</li>
						<li>Audite os Security Groups/Policies/Roles/Grupos/Usuários</li>
						<li>Use MFA</li>
						<li>FW/IPS/IDS de host como uma camada extra de segurança</li>
					</ul>
				</section>
				<section data-background="img/devil-cloud-screaming.jpg" data-background-transition="zoom" data-background-size="cover">
					<h1><font color="darkred">Facing the devil... <br>in the heaven!! </font></h1>
					<!-- Source: <a href="http://www.freakingnews.com/pictures/21500/Devil-Cloud-Screaming-21951.jpg">http://www.freakingnews.com/pictures/21500/Devil-Cloud-Screaming-21951.jpg</a> -->
				</section>
				<section data-background="img/dollarphotoclub.jpg" data-background-transition="zoom" data-background-size="cover">
					<h3>Facilidade para escalar/provisionar tem um trade off... impacto nos custos!</h3>
					<!-- Source: <a href="http://www.ie3media.com/wp-content/uploads/2016/01/Dollarphotoclub_56536541-765x510.jpg">http://www.ie3media.com/wp-content/uploads/2016/01/Dollarphotoclub_56536541-765x510.jpg</a> -->
				</section>
				<section data-background="img/how-to-make-money-in-the-auto-repossession-business.jpg" data-background-transition="fade" data-background-size="cover">
					<!-- Source: <a href="http://repoindustry.com/blog/wp-content/uploads/2012/01/how-to-make-money-in-the-auto-repossession-business.jpg">http://repoindustry.com/blog/wp-content/uploads/2012/01/how-to-make-money-in-the-auto-repossession-business.jpg</a> -->
				</section>
				<section>
					<h3>Facing the devil...</h3>
					<p>
						<ul>
							<ul>
								<li>Load:</li>
									<ul>
										<small>
											<li>Crawling</li>
											<li>DoS/DDoS Attack</li>
											<li>Application looping</li>
										</small>
									</ul><br>
									<li>Acesso local na instância:</li>
										<ul>
											<small>
												<li>Exploração de roles atachadas na instância</li>
												<li>Exploração de Security Groups genéricos</li>
												<li>Outbound traffic</li>
											</small>
										</ul><br>
									<li>Credenciais:</li>
										<ul>
											<small>
												<li>Vazamento de credenciais com acesso de provisionamento (repos publicos no github)</li>
												<li>Outbound traffic...</li>
											</small>
										</ul>
								</ul>
							</ul>
						</p>
				</section>
				<section data-background="img/aws-keys-github.png" data-background-transition="fade" data-background-size="contain">
				</section>
				<section data-background="img/under_attack.jpg" data-background-transition="zoom" data-background-size="contain">
					<h1>Sob fogo cerrado</h1>
				</section>
				<section data-background="img/webcrawlerimage.jpg" data-background-transition="fade" data-background-size="contain">
					<h2>Web Crawling/Scraping/DoS</h2>
				</section>
				<section data-background="img/money-meme.jpg" data-transition="zoom" data-background-size="1100px">
				</section>
				<section>
					<h3>Importante pensar em:</h3>
					<ul>
						<li>WAF: Web Application Firewall</li>
						<li>CDN: Content Delivery Network</li>
						<li>Web Cache: to offload web servers</li>
						<li>Web Server/Cache: Rate limit / Throttling</li>
						<ul>
							<li>
								<pre><code class="hljs" data-trim contenteditable>
// the check ....for 10 req/minute
if(throttle.is_allowed(req.http.Host + "wp1", "10req/m") > 0s)
{
        std.log("XXX Rate limit 10req/m throttling : "
	+ req.http.Host + " too many requests for "
	+ req.url + " / " + req.http.X-Forwarded-For );
        error 429 "Calm down";
}								</code></pre>
							</li>
							<li>
								<pre><code class="hljs" data-trim contenteditable>
									limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;

server {
    location /search/ {
        limit_req zone=one burst=5;
    }
								</code></pre>
							</li>
						</ul>
					</ul>
				</section>

				<section>
					<h3>Quem controla as chaves? De quem são os dados? A nuvem é o céu ou um inferno distante?</h3>
					<img src="img/mi_casa_es_su_casa.jpg" alt="Mi Casa Es Su Casa" style="width:800px;height:400px;border:1">
					<p>
						<small>
							Imagem: <a href:"https://www.skillshare.com/classes/design/Hand-Lettering-for-Chalk-Murals/1930585582/projects/47558?utm_campaign=project-share-1930585582-47558&utm_source=Facebook&utm_medium=project-share">Silkshare</a>
						</small>
					</p>
				</section>
				<section data-background="img/stay-tuned.jpg" data-background-transition="fade" data-background-size="contain">
				</section>
				<section>
					<h1><b>Obrigado!!!</b></h1>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
